<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="Eddy Zhou">
  
  <meta name="description" content="Spring Boot é›†æˆ Liquibase">
  
  
  <meta name="keywords" content="springboot,, liquibase">
  

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring Boot é›†æˆ Liquibase"/>
<meta name="twitter:description" content="Spring Boot é›†æˆ Liquibase"/>

  <meta property="og:title" content="Spring Boot é›†æˆ Liquibase" />
<meta property="og:description" content="Spring Boot é›†æˆ Liquibase" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.zhouyi.tech/archives/spring-boot-%E9%9B%86%E6%88%90-liquibase/" />
<meta property="article:published_time" content="2020-08-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-08-24T00:00:00+00:00" /><meta property="og:site_name" content="ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯" />


  



  
  <base href="https://www.zhouyi.tech/archives/spring-boot-%E9%9B%86%E6%88%90-liquibase/">
  
  <title>
  Spring Boot é›†æˆ Liquibase Â· ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯
</title>

  
  <link rel="canonical" href="https://www.zhouyi.tech/archives/spring-boot-%E9%9B%86%E6%88%90-liquibase/">
  

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

  
  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/coder.min.4aab773750c0433c68c0e2280201a35fa394baf9ef7016cf8f8ae4ba96e597dc.css" integrity="sha256-Sqt3N1DAQzxowOIoAgGjX6OUuvnvcBbPj4rkupbll9w="
    crossorigin="anonymous" media="screen" />
  

  

  
  
  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU="
    crossorigin="anonymous" media="screen" />
  
  

  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/main.css" />
  

  
  <script src="https://www.zhouyi.tech/js/lazysizes.min.js" async></script>
  
  <script src="https://www.zhouyi.tech/js/flying-pages.min.js" async></script>
  

  <link rel="icon" type="image/png" href="https://www.zhouyi.tech/images/f/favicon-32x32.png"
    sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.zhouyi.tech/images/f/favicon-16x16.png"
    sizes="16x16">

  <link rel="amphtml" type="text/html" href="https://www.zhouyi.tech/amp/archives/spring-boot-%E9%9B%86%E6%88%90-liquibase/" title="ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯" />
  <meta name="generator" content="Hugo 0.75.1" />

  <meta name="baidu-site-verification" content="TiReu51WyJ" />

  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/scss/tagcloud.css" media="screen" />

</head>






<body class="colorscheme-auto">
  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.zhouyi.tech/">
      ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.zhouyi.tech/archives/">æŠ€æœ¯</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.zhouyi.tech/about/">å…³äº</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1>Spring Boot é›†æˆ Liquibase</h1>
    </header>

    <p><code>Liquibase</code> æ˜¯ä¸€ä¸ªç”¨äºè·Ÿè¸ªã€ç®¡ç†å’Œåº”ç”¨æ•°æ®åº“å˜åŒ–çš„å¼€æºçš„æ•°æ®åº“é‡æ„å·¥å…·ã€‚å®ƒå°†æ‰€æœ‰æ•°æ®åº“çš„å˜åŒ–ï¼ˆåŒ…æ‹¬ç»“æ„å’Œæ•°æ®ï¼‰éƒ½ä¿å­˜åœ¨ <code>changelog </code>æ–‡ä»¶ä¸­ï¼Œä¾¿äºç‰ˆæœ¬æ§åˆ¶ï¼Œå®ƒçš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§æ•°æ®åº“ç±»å‹æ— å…³çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡æ‰§è¡Œ schema ç±»å‹çš„æ–‡ä»¶æ¥è¾¾åˆ°è¿ç§»ã€‚</p>
<h3 id="liquibase-ç‰¹æ€§">Liquibase ç‰¹æ€§</h3>
<p>Liquibase å…·å¤‡å¦‚ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>æ”¯æŒå‡ ä¹æ‰€æœ‰ä¸»æµçš„æ•°æ®åº“ï¼Œå¦‚ MySQL, PostgreSQL, Oracle, Sql Server, DB2 ç­‰ï¼›</li>
<li>æ”¯æŒå¤šå¼€å‘è€…çš„åä½œç»´æŠ¤ï¼›</li>
<li>æ—¥å¿—æ–‡ä»¶æ”¯æŒå¤šç§æ ¼å¼ï¼Œå¦‚ XML, YAML, JSON, SQLç­‰ï¼›</li>
<li>æ”¯æŒä¸Šä¸‹æ–‡ç›¸å…³é€»è¾‘</li>
<li>ç”Ÿæˆæ•°æ®åº“å˜æ›´æ–‡æ¡£</li>
<li>æ”¯æŒå¤šç§è¿è¡Œæ–¹å¼ï¼Œå¦‚å‘½ä»¤è¡Œã€Spring é›†æˆã€Maven æ’ä»¶ã€Gradle æ’ä»¶ç­‰ã€‚</li>
</ul>
<p>æ›´å¤šè¯¦æƒ…ä»‹ç»ï¼Œè¯·æŸ¥é˜… <a href="https://www.liquibase.org/documentation/index.html">Liquibase å®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="spring-boot-é›†æˆ-liquibase">Spring Boot é›†æˆ Liquibase</h3>
<h4 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ–</h4>
<p>å› ä¸º Spring Boot å·²ç»å†…ç½®æ”¯æŒæ•´åˆ Liquibaseï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é¡¹ç›®å·¥ç¨‹ä¸­å¼•å…¥ Liquibase çš„ä¾èµ–è¿›è¡Œé…ç½®å³å¯ã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="font-weight:bold">&lt;dependency&gt;</span>
    <span style="font-weight:bold">&lt;groupId&gt;</span>org.liquibase<span style="font-weight:bold">&lt;/groupId&gt;</span>
    <span style="font-weight:bold">&lt;artifactId&gt;</span>liquibase-core<span style="font-weight:bold">&lt;/artifactId&gt;</span>
    <span style="font-weight:bold">&lt;version&gt;</span>3.6.3<span style="font-weight:bold">&lt;/version&gt;</span>
<span style="font-weight:bold">&lt;/dependency&gt;</span>
</code></pre></div><h4 id="é…ç½®-application-æ–‡ä»¶">é…ç½® application æ–‡ä»¶</h4>
<p>åœ¨ classpath ä¸­é…ç½® application.properties æˆ– application.yml æ–‡ä»¶ï¼Œ</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback"># å¯ç”¨liquibase
liquibase.enabled=true
# å­˜å‚¨å˜åŒ–çš„æ–‡ä»¶ï¼ˆchangelogï¼‰ä½ç½®
liquibase.change-log=classpath:sample_change.sql
# æ£€æŸ¥å­˜å‚¨å˜åŒ–çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨
liquibase.check-change-log-location=true
# åˆ†ç¯å¢ƒæ‰§è¡Œï¼Œè‹¥åœ¨ changelog æ–‡ä»¶ä¸­è®¾ç½®äº†å¯¹åº” context å±æ€§ï¼Œåˆ™åªä¼šæ‰§è¡Œä¸ dev å¯¹åº”å€¼çš„ changeset
liquibase.contexts=dev
# æ‰§è¡Œå‰é¦–å…ˆåˆ é™¤æ•°æ®åº“ï¼Œé»˜è®¤ falseã€‚è‹¥è®¾ç½®ä¸º trueï¼Œåˆ™æ‰§è¡Œå˜æ›´å‰ï¼Œä¼šå…ˆåˆ é™¤ç›®æ ‡æ•°æ®åº“ï¼Œè¯·è°¨æ…
liquibase.dropFirst=false
# æ‰§è¡Œæ›´æ–°æ—¶å°†å›æ»š SQL å†™å…¥çš„æ–‡ä»¶è·¯å¾„
liquibase.rollback-file=
# å¦‚æœä½¿ç”¨å·¥ç¨‹å·²é…ç½®çš„ datasource æ•°æ®æºï¼Œåˆ™ä»¥ä¸‹ä¸‰ä¸ªæ•°æ®åº“è¿æ¥å‚æ•°å¯ä¸é…ç½®
## è®¿é—®æ•°æ®åº“çš„è¿æ¥åœ°å€
liquibase.url=jdbc:mysql://127.0.0.1:3306/test?useUnicode=true&amp;characterEncoding=utf-8
# è®¿é—®æ•°æ®åº“çš„ç”¨æˆ·å
liquibase.user=test
# è®¿é—®æ•°æ®åº“çš„å¯†ç 
liquibase.password=test

</code></pre></div><blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä½¿ç”¨å·¥ç¨‹å·²é…ç½®çš„ <code>datasource</code> æ•°æ®æºï¼Œåˆ™ <code>liquibase.urlã€liquibase.user</code> å’Œ <code>liquibase.password</code>è¿™ä¸ªä¸‰ä¸ªå‚æ•°å¯ä¸é…ç½®ï¼Œç›®æ ‡æ•°æ®æºå³ä¸ºå·¥ç¨‹å·²é…ç½®å¥½çš„æ•°æ®æºã€‚å› ä¸º Spring ä¼šè‡ªåŠ¨ä¸º liquibase è·å–å¯ç”¨çš„æ•°æ®æºï¼Œè¯¦æƒ…å¯æŸ¥çœ‹è¿™ä¸ªç±»ï¼š<code>org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration</code>ã€‚</p>
</blockquote>
<h4 id="ç¼–å†™å­˜å‚¨å˜æ›´çš„-changelog-æ–‡ä»¶">ç¼–å†™å­˜å‚¨å˜æ›´çš„ changelog æ–‡ä»¶</h4>
<p>ç›®å‰ Liquibase æ”¯æŒ XMLã€YAMLã€JSON å’Œ SQL æ ¼å¼å››ç§æ ¼å¼çš„ changelog æ–‡ä»¶ã€‚ä¸ºäº†æ–¹ä¾¿å’Œç›´è§‚ï¼Œä¸‹é¢ä»¥åŸºäº SQL æ ¼å¼ç¼–å†™ changelog æ–‡ä»¶ï¼šsample_change.sql</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--liquibase formatted <span style="color:#fff;font-weight:bold">sql</span>

--changeset zhouyi:<span style="color:#ff0;font-weight:bold">1</span>
<span style="color:#007f7f">-- åˆ›å»ºç”¨æˆ·è¡¨
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `<span style="color:#fff;font-weight:bold">user</span>` (
  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL <span style="color:#fff;font-weight:bold">AUTO_INCREMENT</span>,
  `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">50</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,
  `age` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">10</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,
  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
) <span style="color:#fff;font-weight:bold">ENGINE</span>=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">CHARSET</span>=utf8;

--rollback <span style="color:#fff;font-weight:bold">drop</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">user</span>;

--changeset zhouyi:<span style="color:#ff0;font-weight:bold">2</span>
<span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> <span style="color:#fff;font-weight:bold">user</span>(id, name, age) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#ff0;font-weight:bold">1</span>,<span style="color:#0ff;font-weight:bold">&#39;å¼ ä¸‰&#39;</span>,<span style="color:#ff0;font-weight:bold">29</span>);
<span style="color:#fff;font-weight:bold">insert</span> <span style="color:#fff;font-weight:bold">into</span> <span style="color:#fff;font-weight:bold">user</span>(id, name, age) <span style="color:#fff;font-weight:bold">values</span>(<span style="color:#ff0;font-weight:bold">2</span>,<span style="color:#0ff;font-weight:bold">&#39;æå››&#39;</span>,<span style="color:#ff0;font-weight:bold">20</span>);
</code></pre></div><p>å¯åŠ¨ Spring Boot åº”ç”¨åï¼Œå¯ä»¥ä»æ—¥å¿—çœ‹åˆ°è¾“å‡ºï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">2019-03-27 13:13:16.439 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - DELETE FROM test.DATABASECHANGELOGLOCK
2019-03-27 13:13:16.442 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - INSERT INTO test.DATABASECHANGELOGLOCK (ID, `LOCKED`) VALUES (1, 0)
2019-03-27 13:13:16.506 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - SELECT `LOCKED` FROM test.DATABASECHANGELOGLOCK WHERE ID=1
2019-03-27 13:13:16.586 [main] [] INFO  liquibase.lockservice.StandardLockService.info:42 - Successfully acquired change log lock
2019-03-27 13:13:16.697 [main] [] INFO  liquibase.changelog.StandardChangeLogHistoryService.info:42 - Creating database history table with name: test.DATABASECHANGELOG
2019-03-27 13:13:16.700 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - CREATE TABLE test.DATABASECHANGELOG (ID VARCHAR(255) NOT NULL, AUTHOR VARCHAR(255) NOT NULL, FILENAME VARCHAR(255) NOT NULL, DATEEXECUTED datetime NOT NULL, ORDEREXECUTED INT NOT NULL, EXECTYPE VARCHAR(10) NOT NULL, MD5SUM VARCHAR(35) NULL, `DESCRIPTION` VARCHAR(255) NULL, COMMENTS VARCHAR(255) NULL, TAG VARCHAR(255) NULL, LIQUIBASE VARCHAR(20) NULL, CONTEXTS VARCHAR(255) NULL, LABELS VARCHAR(255) NULL, DEPLOYMENT_ID VARCHAR(10) NULL)
2019-03-27 13:13:17.570 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - SELECT COUNT(*) FROM test.DATABASECHANGELOG
2019-03-27 13:13:17.575 [main] [] INFO  liquibase.changelog.StandardChangeLogHistoryService.info:42 - Reading from test.DATABASECHANGELOG
2019-03-27 13:13:17.579 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - SELECT * FROM test.DATABASECHANGELOG ORDER BY DATEEXECUTED ASC, ORDEREXECUTED ASC
2019-03-27 13:13:17.585 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - SELECT COUNT(*) FROM test.DATABASECHANGELOGLOCK
2019-03-27 13:13:17.678 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - CREATE TABLE `user` (
  `id` int(20) NOT NULL AUTO_INCREMENT,
  `name` varchar(50) NOT NULL,
  `age` int(10) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
2019-03-27 13:13:17.935 [main] [] INFO  liquibase.changelog.ChangeSet.info:42 - Custom SQL executed
2019-03-27 13:13:17.937 [main] [] INFO  liquibase.changelog.ChangeSet.info:42 - ChangeSet classpath:sample_change.sql::1::zhouyi ran successfully in 297ms
2019-03-27 13:13:17.938 [main] [] INFO  liquibase.executor.jvm.JdbcExecutor.info:42 - SELECT MAX(ORDEREXECUTED) FROM test.DATABASECHANGELOG

</code></pre></div><p>ä»æ•°æ®åº“ä¸­å¯ä»¥çœ‹åˆ°å˜åŒ–ï¼Œé¦–æ¬¡è¿è¡Œæ–°å¢äº† 3 å¼ è¡¨ï¼Œ
<img src="https://www.zhouyi.tech/upload/2020/06/table-52f4112c5d114d94a11c76e50e512f67.jpg" alt="table"></p>
<p>å…¶ä¸­<code>DATABASECHANGELOG</code> å’Œ <code>DATABASECHANGELOGLOCK</code> è¡¨æ˜¯ Liquibase è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œè€Œ <code>user</code> è¡¨æ˜¯æ‰§è¡Œæˆ‘ä»¬ç¼–å†™çš„  <code>changeset</code>å˜æ›´é›†åç”Ÿæˆçš„ï¼Œå¹¶ä¸”ä¹Ÿå·²ç»æ‰§è¡Œäº†ç¬¬ 2 ä¸ªå˜æ›´é›†ï¼Œæ’å…¥äº†ä¸¤æ¡æ•°æ®ã€‚</p>
<h3 id="sql-æ ¼å¼çš„-changelogs-æ–‡ä»¶">SQL æ ¼å¼çš„ changelogs æ–‡ä»¶</h3>
<p>SQL æ ¼å¼çš„ <code>changelog</code> æ–‡ä»¶ä½¿ç”¨ SQL æ³¨é‡Šä½œä¸ºå…ƒæ•°æ®ï¼Œä¸ºç¡®ä¿è¿™ä¸ªæ–‡ä»¶è¢« Liquibase è¯†åˆ«ä¸º <code>changelog </code>æ–‡ä»¶ï¼Œï¼ŒSQL æ–‡ä»¶å¿…é¡»ä»¥ä»¥ä¸‹æ³¨é‡Šå¼€å¤´ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--liquibase formatted <span style="color:#fff;font-weight:bold">sql</span>
</code></pre></div><h4 id="changeset-å˜æ›´">changeset å˜æ›´</h4>
<p>SQL æ ¼å¼çš„ <code>changelog</code> æ–‡ä»¶ä¸­åœ¨å˜æ›´çš„ SQL å‰éœ€è¦åŠ ä¸Šä»¥ä¸‹æ³¨é‡Šï¼Œè¡¨ç¤ºä¸ºä¸€ä¸ª <code>changeset </code>å˜æ›´é›†ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--changeset author:id attribute1:value1 attribute2:value2 [...]
</code></pre></div><p>åœ¨ä¹‹å‰çš„ <code>sample_change.sql</code> æ–‡ä»¶ä¸­ç¼–å†™äº†ä¸¤æ¡ <code>changeset</code> (å˜æ›´é›†)ï¼Œ</p>
<p>å˜æ›´é›† <code>changeset</code> æ˜¯é€šè¿‡ <code>author + id</code> çš„æ–¹å¼æ¥ä¿è¯å”¯ä¸€æ€§ï¼Œå¦‚ä»¥ä¸Š <code>zhouyi:1</code> å’Œ  <code>zhouyi:2</code> ä¸¤æ¡è¡¨æ›´é›†ã€‚</p>
<p>å˜æ›´é›†æä¾›ä»¥ä¸‹å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>stripComments</td>
<td>è®¾ç½®ä¸º true å¯åœ¨æ‰§è¡Œä¹‹å‰åˆ é™¤ SQL ä¸­çš„ä»»ä½•æ³¨é‡Š, å¦åˆ™ä¸º falseã€‚å¦‚æœæœªè®¾ç½®, åˆ™é»˜è®¤å€¼ä¸º true</td>
</tr>
<tr>
<td>splitStatements</td>
<td></td>
</tr>
<tr>
<td>endDelimiter</td>
<td>åº”ç”¨äºè¯­å¥ç»“å°¾çš„åˆ†éš”ç¬¦ã€‚é»˜è®¤ä¸ºâ€œï¼›â€ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºâ€œâ€</td>
</tr>
<tr>
<td>runAlways</td>
<td>åœ¨æ¯æ¬¡è¿è¡Œæ—¶æ‰§è¡Œå˜æ›´é›†, å³ä½¿ä¹‹å‰å·²è¿è¡Œ</td>
</tr>
<tr>
<td>runOnChange</td>
<td>åœ¨é¦–æ¬¡çœ‹åˆ°æ›´æ”¹å¹¶æ¯æ¬¡æ›´æ”¹å˜æ›´é›†æ—¶æ‰§è¡Œæ›´æ”¹</td>
</tr>
<tr>
<td>context</td>
<td>å¦‚æœåœ¨è¿è¡Œæ—¶ä¼ é€’äº†ç‰¹å®šä¸Šä¸‹æ–‡, åˆ™æ‰§è¡Œæ›´æ”¹ã€‚ä»»ä½•å­—ç¬¦ä¸²éƒ½å¯ä»¥ç”¨äºä¸Šä¸‹æ–‡åç§°, å¹¶ä¸”å¤§å°å†™ä¸æ•æ„Ÿã€‚</td>
</tr>
<tr>
<td>logicalFilePath</td>
<td>ç”¨äºåœ¨åˆ›å»ºå˜æ›´é›†çš„å”¯ä¸€æ ‡è¯†ç¬¦æ—¶é‡å†™æ–‡ä»¶åå’Œè·¯å¾„ã€‚ç§»åŠ¨æˆ–é‡å‘½åæ›´æ”¹æ—¥å¿—æ—¶æ‰€å¿…éœ€ã€‚</td>
</tr>
<tr>
<td>labels</td>
<td>æ ‡ç­¾æ˜¯å¯¹å˜æ›´é›†è¿›è¡Œåˆ†ç±»çš„é€šç”¨æ–¹æ³•é›†ç±»ä¼¼ä¸Šä¸‹æ–‡, ä½†å·¥ä½œæ–¹å¼æ­£å¥½ç›¸åã€‚å¦‚æœä¸æ˜¯åœ¨è¿è¡Œæ—¶å®šä¹‰ä¸€ç»„ä¸Šä¸‹æ–‡, ç„¶ååœ¨å˜æ›´é›†ä¸­å®šä¹‰ä¸€ä¸ªåŒ¹é…è¡¨è¾¾å¼, è€Œæ˜¯åœ¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰ä¸€ç»„æ ‡ç­¾, åœ¨è¿è¡Œæ—¶å®šä¹‰ä¸€ä¸ªåŒ¹é…è¡¨è¾¾å¼ã€‚</td>
</tr>
<tr>
<td>runInTransaction</td>
<td>å˜æ›´é›†æ˜¯å¦åº”ä½œä¸ºå•ä¸ªäº‹åŠ¡è¿è¡Œ (å¦‚æœå¯èƒ½)ï¼Œé»˜è®¤å€¼ä¸º trueã€‚è¯·æ³¨æ„æ­¤å±æ€§ï¼Œå¦‚æœè®¾ç½®ä¸º false, å¹¶ä¸”é€šè¿‡è¿è¡ŒåŒ…å«å¤šä¸ªè¯­å¥çš„å˜æ›´é›†éƒ¨åˆ†å‘ç”Ÿé”™è¯¯, åˆ™ liquibase æ•°æ®åº“çš„ <code>databasechangeloglock</code> è¡¨å°†å¤„äºæ— æ•ˆçŠ¶æ€</td>
</tr>
<tr>
<td>failOnError</td>
<td>å¦‚æœåœ¨æ‰§è¡Œå˜æ›´é›†æ—¶å‘ç”Ÿé”™è¯¯, è¿ç§»æ˜¯å¦åº”è¿”å›å¤±è´¥</td>
</tr>
<tr>
<td>dbms</td>
<td>è¦ç”¨äºè¯¥å˜æ›´é›†çš„æ•°æ®åº“çš„ç±»å‹ã€‚å½“è¿ç§»æ­¥éª¤è¿è¡Œæ—¶, å®ƒå°†æ ¹æ®æ­¤å±æ€§æ£€æŸ¥æ•°æ®åº“ç±»å‹ï¼Œå¦‚ï¼šoracleã€mysql</td>
</tr>
<tr>
<td>logicalFilePath</td>
<td>åœ¨æ•°æ®åº“ <code>databasechangeloglock</code> ä¸­è®¾ç½®é€»è¾‘æ–‡ä»¶è·¯å¾„, è€Œä¸æ˜¯åœ¨æ‰§è¡Œ liquibase çš„ sql ç‰©ç†æ–‡ä»¶ä½ç½®ã€‚</td>
</tr>
</tbody>
</table>
<h4 id="å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</h4>
<p>å¯ä»¥ä¸ºæ¯ä¸ªå˜æ›´é›†æŒ‡å®šå…ˆå†³æ¡ä»¶ã€‚ç›®å‰, ä»…æ”¯æŒ SQL æ£€æŸ¥å‰ç½®æ¡ä»¶ã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--preconditions onFail:HALT onError:HALT
--precondition-<span style="color:#fff;font-weight:bold">sql</span>-<span style="color:#fff;font-weight:bold">check</span> expectedResult:<span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">SELECT</span> COUNT(*) <span style="color:#fff;font-weight:bold">FROM</span> my_table
</code></pre></div><h4 id="å›æ»šæ“ä½œ">å›æ»šæ“ä½œ</h4>
<p>å˜æ›´é›†å¯èƒ½åŒ…æ‹¬å›æ»šå˜æ›´é›†æ—¶è¦åº”ç”¨çš„è¯­å¥ã€‚å›æ»šå£°æ˜ä¹Ÿæ˜¯ä½¿ç”¨è¡¨æ³¨é‡Šã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--rollback <span style="color:#fff;font-weight:bold">SQL</span> STATEMENT
</code></pre></div><p>ä¾‹å¦‚åœ¨å‰é¢ç¼–å†™çš„ changelog æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ª changesetï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-mysql" data-lang="mysql">--changeset zhouyi:<span style="color:#ff0;font-weight:bold">1</span>
<span style="color:#007f7f">-- åˆ›å»ºç”¨æˆ·è¡¨
</span><span style="color:#007f7f"></span><span style="color:#fff;font-weight:bold">CREATE</span> <span style="color:#fff;font-weight:bold">TABLE</span> `<span style="color:#fff;font-weight:bold">user</span>` (
  `id` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">20</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL <span style="color:#fff;font-weight:bold">AUTO_INCREMENT</span>,
  `name` <span style="color:#fff;font-weight:bold">varchar</span>(<span style="color:#ff0;font-weight:bold">50</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,
  `age` <span style="color:#fff;font-weight:bold">int</span>(<span style="color:#ff0;font-weight:bold">10</span>) <span style="color:#fff;font-weight:bold">NOT</span> NULL,
  <span style="color:#fff;font-weight:bold">PRIMARY</span> <span style="color:#fff;font-weight:bold">KEY</span> (`id`)
) <span style="color:#fff;font-weight:bold">ENGINE</span>=InnoDB <span style="color:#fff;font-weight:bold">DEFAULT</span> <span style="color:#fff;font-weight:bold">CHARSET</span>=utf8;

--rollback <span style="color:#fff;font-weight:bold">drop</span> <span style="color:#fff;font-weight:bold">table</span> <span style="color:#fff;font-weight:bold">user</span>;
</code></pre></div><p>é¦–å…ˆçš„å˜æ›´çš„ SQL å«ä¹‰æ˜¯æ–°å»ºä¸€ä¸ª <code>user</code> è¡¨ï¼Œå›æ»šçš„ SQL åˆ™è¡¨ç¤ºåˆ é™¤æ–°å»ºçš„ <code>user</code> è¡¨ã€‚</p>
<h3 id="liquibase-æœ€ä½³å®è·µ">Liquibase æœ€ä½³å®è·µ</h3>
<p>ä¸‹é¢ä»‹ç»å¯åº”ç”¨äºé¡¹ç›®çš„ä¸€äº›æœ€ä½³å®è·µã€‚</p>
<h4 id="ä¸€ä¸ªå˜æ›´é›†åªè®¾ç½®ä¸€æ¬¡æ›´æ”¹">ä¸€ä¸ªå˜æ›´é›†åªè®¾ç½®ä¸€æ¬¡æ›´æ”¹</h4>
<p>å°½å¯èƒ½åœ°é¿å…å¯¹ä¸€ä¸ªå˜æ›´é›†è¿›è¡Œå¤šæ¬¡æ›´æ”¹ï¼Œä»¥é¿å…è‡ªåŠ¨æäº¤ SQL è¯­å¥è€Œå¯èƒ½ä½¿æ•°æ®åº“å¤„äºéé¢„æœŸçŠ¶æ€ã€‚
å¦‚ <code>--changeset zhouyi:1</code> å˜æ›´é›†ï¼Œåªæ–°å»ºä¸€å¼  <code>user</code> è¡¨ï¼Œåé¢ä¸å†ä¿®æ”¹è¯¥å˜æ›´é›†ï¼Œå¦‚æœéœ€è¦å˜æ›´ï¼Œå¯ä»¥æ–°å¢ä¸€æ¡å˜æ›´é›†ã€‚</p>
<h4 id="å˜æ›´é›†çš„-id">å˜æ›´é›†çš„ ID</h4>
<p>é€‰æ‹©é€‚åˆæ‚¨çš„æ–¹æ³•ã€‚æœ‰çš„äººæ˜¯ä½¿ç”¨ä» 1 å¼€å§‹çš„åºåˆ—å·, å¹¶ä¸”åœ¨æ›´æ”¹æ—¥å¿—ä¸­æ˜¯å”¯ä¸€çš„ï¼Œä¹Ÿæœ‰äº›äººé€‰æ‹©ä¸€ä¸ªæè¿°æ€§çš„åç§°ï¼ˆä¾‹å¦‚ï¼š<code>new-address-table</code>ï¼‰</p>
<h4 id="æ€»æ˜¯è€ƒè™‘å›æ»š">æ€»æ˜¯è€ƒè™‘å›æ»š</h4>
<p>å°½é‡å°è¯•ä»¥å¯ä»¥å›æ»šçš„æ–¹å¼ç¼–å†™å˜æ›´é›†ï¼Œå¦‚ <code>--changeset zhouyi:1 </code> å˜æ›´é›†æ–°å»ºä¸€ä¸ª <code>user</code> è¡¨ï¼Œåœ¨åé¢è·Ÿä¸Šå›æ»šçš„ SQLï¼Œ <code>--rollback drop table user;</code></p>
<h4 id="ä¸ºå˜æ›´é›†æ·»åŠ æ³¨é‡Š">ä¸ºå˜æ›´é›†æ·»åŠ æ³¨é‡Š</h4>
<p>å°½é‡ä¸ºæ¯ä¸€ä¸ªå˜æ›´é›†æ¡ç›®å¢åŠ æ³¨é‡Šï¼Œå¦‚  <code>-- åˆ›å»ºç”¨æˆ·è¡¨</code></p>
<h4 id="å¼€å‘äººå‘˜ä½¿ç”¨æµç¨‹">å¼€å‘äººå‘˜ä½¿ç”¨æµç¨‹</h4>
<ul>
<li>ä½¿ç”¨æ‚¨æœ€å–œæ¬¢çš„ IDE æˆ–ç¼–è¾‘å™¨, åˆ›å»ºä¸€ä¸ªåŒ…å«æ›´æ”¹çš„æ–°æœ¬åœ°æ›´æ”¹é›†ï¼›</li>
<li>è¿è¡Œ Liquibase ä»¥æ‰§è¡Œæ–°çš„å˜æ›´é›† (è¿™å°†æµ‹è¯• SQL ä»£ç )ï¼›</li>
<li>åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­æ‰§è¡Œç›¸åº”çš„æ›´æ”¹ (ä¾‹å¦‚, Java ä»£ç )ï¼›</li>
<li>æµ‹è¯•éªŒè¯æ–°çš„åº”ç”¨ç¨‹åºä»£ç ä»¥åŠæ•°æ®åº“æ›´æ”¹ï¼›</li>
<li>æäº¤å˜æ›´é›†å’Œåº”ç”¨ç¨‹åºä»£ç ã€‚</li>
</ul>

  </article>
</section>


    </div>

    <footer class="footer">
  <div class="footer-taxonomy">
    <div style="margin-bottom: 10px;">
      <a href="https://wiki.bmpi.dev/" rel="nofollow">Wiki</a>
      âš”ï¸
      <a href="https://talk.bmpi.dev/" rel="nofollow">Talk</a>
      âš”ï¸
      <a href="https://www.notion.so/mdw/e0ed086e701a4d0aaa4839d2c7aa62ea" rel="nofollow">Portfolio</a>
      âš”ï¸
      <a href="https://money.i365.tech/">Money</a>
    </div>
    <div>
      <a href= /affiliate >Affiliate</a>
      âš¡ï¸
      <a href= /tool >Tool</a>
      âš¡ï¸
      <a href= /link >Link</a>
    </div>
  </div>
  <div class="footer-taxonomy">
    <a href= /tags style="color: #B36D61;">Tags</a>
    ğŸ‘ˆ
    <a href= /categories style="color: #FF8C31;">Categories</a>
    ğŸ‘‰
    <a href= /series style="color: #519A73;">Series</a>
  </div>
  <section class="container">
    
     Â© 2019 - 2020
    
    
  </section>
</footer>

  </main>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154678195-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-154678195-1');
  </script>
  

  
  <script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BHuwaXciWicBjh6HQS2tfudv6IYQD11K9u1NUj7nuaEV9NoDT7ns9JjgqyYTflUv-m3TlD7ELY84AHMfgmPXNgU');</script>
  

</body>

</html>
