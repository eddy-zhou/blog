<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <meta name="author" content="Eddy Zhou">
  
  <meta name="description" content="CompletableFuture ä½¿ç”¨ä»‹ç»">
  
  
  <meta name="keywords" content="Java8,, CompletableFuture">
  

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="CompletableFuture ä½¿ç”¨ä»‹ç»"/>
<meta name="twitter:description" content="CompletableFuture ä½¿ç”¨ä»‹ç»"/>

  <meta property="og:title" content="CompletableFuture ä½¿ç”¨ä»‹ç»" />
<meta property="og:description" content="CompletableFuture ä½¿ç”¨ä»‹ç»" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.zhouyi.tech/archives/completablefuture-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" />
<meta property="article:published_time" content="2020-06-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-06-24T00:00:00+00:00" /><meta property="og:site_name" content="ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯" />


  



  
  <base href="https://www.zhouyi.tech/archives/completablefuture-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">
  
  <title>
  CompletableFuture ä½¿ç”¨ä»‹ç» Â· ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯
</title>

  
  <link rel="canonical" href="https://www.zhouyi.tech/archives/completablefuture-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/">
  

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
    integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

  
  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/coder.min.4aab773750c0433c68c0e2280201a35fa394baf9ef7016cf8f8ae4ba96e597dc.css" integrity="sha256-Sqt3N1DAQzxowOIoAgGjX6OUuvnvcBbPj4rkupbll9w="
    crossorigin="anonymous" media="screen" />
  

  

  
  
  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/coder-dark.min.83a2010dac9f59f943b3004cd6c4f230507ad036da635d3621401d42ec4e2835.css" integrity="sha256-g6IBDayfWflDswBM1sTyMFB60DbaY102IUAdQuxOKDU="
    crossorigin="anonymous" media="screen" />
  
  

  
  <link rel="stylesheet" href="https://www.zhouyi.tech/css/main.css" />
  

  
  <script src="https://www.zhouyi.tech/js/lazysizes.min.js" async></script>
  
  <script src="https://www.zhouyi.tech/js/flying-pages.min.js" async></script>
  

  <link rel="icon" type="image/png" href="https://www.zhouyi.tech/images/f/favicon-32x32.png"
    sizes="32x32">
  <link rel="icon" type="image/png" href="https://www.zhouyi.tech/images/f/favicon-16x16.png"
    sizes="16x16">

  <link rel="amphtml" type="text/html" href="https://www.zhouyi.tech/amp/archives/completablefuture-%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D/" title="ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯" />
  <meta name="generator" content="Hugo 0.75.1" />

  <meta name="baidu-site-verification" content="TiReu51WyJ" />

  
  
  <link rel="stylesheet" href="https://www.zhouyi.tech/scss/tagcloud.css" media="screen" />

</head>






<body class="colorscheme-auto">
  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://www.zhouyi.tech/">
      ç¨‹åºå‘˜å­¦ä¹ ä¹‹è·¯
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.zhouyi.tech/archives/">æŠ€æœ¯</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://www.zhouyi.tech/about/">å…³äº</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


    <div class="content">
      
  <section class="container page">
  <article>
    <header>
      <h1>CompletableFuture ä½¿ç”¨ä»‹ç»</h1>
    </header>

    <p>æœ¬æ–‡å®‰åˆ©ä¸€ä¸ª Java8 çš„å·¥å…· <code>CompletableFuture</code>ï¼Œè¿™æ˜¯ Java8 å¸¦æ¥çš„ä¸€ä¸ªéå¸¸å¥½ç”¨çš„ç”¨äºå¼‚æ­¥ç¼–ç¨‹çš„ç±»ã€‚è¿˜æ²¡ä½¿ç”¨è¿‡çš„å°ä¼™ä¼´ï¼Œèµ¶ç´§ç”¨èµ·æ¥å§ã€‚</p>
<p>æœ¬æ–‡ä¸ä»‹ç»å®ƒçš„å®ç°æºç ï¼Œä»…ä»‹ç»å®ƒçš„æ¥å£ä½¿ç”¨ï¼Œæœ¬æ–‡ä¹Ÿä¸åšå®ƒå’Œ RxJava ç­‰å…¶ä»–å¼‚æ­¥ç¼–ç¨‹æ¡†æ¶çš„å¯¹æ¯”ã€‚</p>
<h2 id="å®ä¾‹åŒ–">å®ä¾‹åŒ–</h2>
<p>é¦–å…ˆï¼Œä¸ç®¡æˆ‘ä»¬è¦åšä»€ä¹ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥æ˜¯éœ€è¦æ„é€ å‡º CompletableFuture å®ä¾‹ã€‚</p>
<p>æœ€ç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; cf = <span style="color:#fff;font-weight:bold">new</span> CompletableFuture&lt;String&gt;();
</code></pre></div><p>è¿™ä¸ªå®ä¾‹æ­¤æ—¶è¿˜æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å®é™…çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬é€‰æ‹©ç»“æŸè¿™ä¸ªä»»åŠ¡ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#007f7f">// å¯ä»¥é€‰æ‹©åœ¨å½“å‰çº¿ç¨‹ç»“æŸï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–çº¿ç¨‹ç»“æŸ
</span><span style="color:#007f7f"></span>cf.<span style="color:#007f7f">complete</span>(<span style="color:#0ff;font-weight:bold">&#34;coding...&#34;</span>);
</code></pre></div><p>å› ä¸º CompletableFuture æ˜¯ä¸€ä¸ª Futureï¼Œæˆ‘ä»¬ç”¨ <code>String result = cf.get()</code> å°±èƒ½è·å–åˆ°ç»“æœäº†ã€‚</p>
<blockquote>
<p>CompletableFuture æä¾›äº† <code>join()</code> æ–¹æ³•ï¼Œå®ƒçš„åŠŸèƒ½å’Œ get() æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯é˜»å¡è·å–å€¼ï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äº join() æŠ›å‡ºçš„æ˜¯ unchecked Exceptionã€‚</p>
</blockquote>
<p>ä¸Šé¢çš„ä»£ç ç¡®å®æ²¡ä»€ä¹ˆç”¨ï¼Œä¸‹é¢ä»‹ç»å‡ ä¸ª <strong>static</strong> æ–¹æ³•ï¼Œå®ƒä»¬ä½¿ç”¨ä»»åŠ¡æ¥å®ä¾‹åŒ–ä¸€ä¸ª CompletableFuture å®ä¾‹ã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture.<span style="color:#007f7f">runAsync</span>(Runnable runnable);
CompletableFuture.<span style="color:#007f7f">runAsync</span>(Runnable runnable, Executor executor);

CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(Supplier&lt;U&gt; supplier);
CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(Supplier&lt;U&gt; supplier, Executor executor)
</code></pre></div><ul>
<li>runAsync æ–¹æ³•æ¥æ”¶çš„æ˜¯ Runnable çš„å®ä¾‹ï¼Œæ„å‘³ç€å®ƒæ²¡æœ‰è¿”å›å€¼</li>
<li>supplyAsync æ–¹æ³•å¯¹åº”çš„æ˜¯æœ‰è¿”å›å€¼çš„æƒ…å†µ</li>
<li>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¸¦ <strong>executor</strong> çš„å˜ç§ï¼Œè¡¨ç¤ºè®©ä»»åŠ¡åœ¨æŒ‡å®šçš„çº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼Œä¸æŒ‡å®šçš„è¯ï¼Œé€šå¸¸ä»»åŠ¡æ˜¯åœ¨ <code>ForkJoinPool.commonPool()</code> çº¿ç¨‹æ± ä¸­æ‰§è¡Œçš„ã€‚</li>
</ul>
<p>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†ç¬¬ä¸€ä¸ª CompletableFuture å®ä¾‹äº†ï¼Œæˆ‘ä»¬æ¥çœ‹æ¥ä¸‹æ¥çš„å†…å®¹ã€‚</p>
<h2 id="ä»»åŠ¡ä¹‹é—´çš„é¡ºåºæ‰§è¡Œ">ä»»åŠ¡ä¹‹é—´çš„é¡ºåºæ‰§è¡Œ</h2>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹æ‰§è¡Œä¸¤ä¸ªä»»åŠ¡çš„æƒ…å†µï¼Œé¦–å…ˆæ‰§è¡Œä»»åŠ¡ Aï¼Œç„¶åå°†ä»»åŠ¡ A çš„ç»“æœä¼ é€’ç»™ä»»åŠ¡ Bã€‚</p>
<p>å…¶å®è¿™é‡Œæœ‰å¾ˆå¤šç§æƒ…å†µï¼Œä»»åŠ¡ A æ˜¯å¦æœ‰è¿”å›å€¼ï¼Œä»»åŠ¡ B æ˜¯å¦éœ€è¦ä»»åŠ¡ A çš„è¿”å›å€¼ï¼Œä»»åŠ¡ B æ˜¯å¦æœ‰è¿”å›å€¼ï¼Œç­‰ç­‰ã€‚æœ‰ä¸ªæ˜ç¡®çš„å°±æ˜¯ï¼Œè‚¯å®šæ˜¯ä»»åŠ¡ A æ‰§è¡Œå®Œåå†æ‰§è¡Œä»»åŠ¡ Bã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸‹é¢çš„ 6 è¡Œä»£ç æ¥è¯´ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture.<span style="color:#007f7f">runAsync</span>(() -&gt; {}).<span style="color:#007f7f">thenRun</span>(() -&gt; {}); 
CompletableFuture.<span style="color:#007f7f">runAsync</span>(() -&gt; {}).<span style="color:#007f7f">thenAccept</span>(resultA -&gt; {}); 
CompletableFuture.<span style="color:#007f7f">runAsync</span>(() -&gt; {}).<span style="color:#007f7f">thenApply</span>(resultA -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultB&#34;</span>);

CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>).<span style="color:#007f7f">thenRun</span>(() -&gt; {});
CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>).<span style="color:#007f7f">thenAccept</span>(resultA -&gt; {});
CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>).<span style="color:#007f7f">thenApply</span>(resultA -&gt; resultA + <span style="color:#0ff;font-weight:bold">&#34; resultB&#34;</span>);
</code></pre></div><p>å‰é¢ 3 è¡Œä»£ç æ¼”ç¤ºçš„æ˜¯ï¼Œä»»åŠ¡ A æ— è¿”å›å€¼ï¼Œæ‰€ä»¥å¯¹åº”çš„ï¼Œç¬¬ 2 è¡Œå’Œç¬¬ 3 è¡Œä»£ç ä¸­ï¼ŒresultA å…¶å®æ˜¯ <code>null</code>ã€‚</p>
<p>ç¬¬ 4 è¡Œç”¨çš„æ˜¯ <code>thenRun(Runnable runnable)</code>ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼Œå¹¶ä¸” B ä¸éœ€è¦ A çš„ç»“æœã€‚</p>
<p>ç¬¬ 5 è¡Œç”¨çš„æ˜¯ <code>thenAccept(Consumer action)</code>ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼ŒB éœ€è¦ A çš„ç»“æœï¼Œä½†æ˜¯ä»»åŠ¡ B ä¸è¿”å›å€¼ã€‚</p>
<p>ç¬¬ 6 è¡Œç”¨çš„æ˜¯ <code>thenApply(Function fn)</code>ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œæ‰§è¡Œ Bï¼ŒB éœ€è¦ A çš„ç»“æœï¼ŒåŒæ—¶ä»»åŠ¡ B æœ‰è¿”å›å€¼ã€‚</p>
<p>è¿™ä¸€å°èŠ‚è¯´å®Œäº†ï¼Œå¦‚æœä»»åŠ¡ B åé¢è¿˜æœ‰ä»»åŠ¡ Cï¼Œå¾€ä¸‹ç»§ç»­è°ƒç”¨ <code>.thenXxx()</code> å³å¯ã€‚</p>
<h3 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h3>
<p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬é¡ºä¾¿æ¥è¯´ä¸‹ CompletableFuture çš„å¼‚å¸¸å¤„ç†ã€‚è¿™é‡Œæˆ‘ä»¬è¦ä»‹ç»ä¸¤ä¸ªæ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">public</span> CompletableFuture&lt;T&gt; exceptionally(Function&lt;Throwable, ? <span style="color:#fff;font-weight:bold">extends</span> T&gt; fn);
<span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletionStage&lt;U&gt; handle(BiFunction&lt;? <span style="color:#fff;font-weight:bold">super</span> T, Throwable, ? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn);
</code></pre></div><p>çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>)
    .<span style="color:#007f7f">thenApply</span>(resultA -&gt; resultA + <span style="color:#0ff;font-weight:bold">&#34; resultB&#34;</span>)
    .<span style="color:#007f7f">thenApply</span>(resultB -&gt; resultB + <span style="color:#0ff;font-weight:bold">&#34; resultC&#34;</span>)
    .<span style="color:#007f7f">thenApply</span>(resultC -&gt; resultC + <span style="color:#0ff;font-weight:bold">&#34; resultD&#34;</span>);
</code></pre></div><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä»»åŠ¡ Aã€Bã€Cã€D ä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœä»»åŠ¡ A æŠ›å‡ºå¼‚å¸¸ï¼ˆå½“ç„¶ä¸Šé¢çš„ä»£ç ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œé‚£ä¹ˆåé¢çš„ä»»åŠ¡éƒ½å¾—ä¸åˆ°æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡ C æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä»»åŠ¡ D å¾—ä¸åˆ°æ‰§è¡Œã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆå¤„ç†å¼‚å¸¸å‘¢ï¼Ÿçœ‹ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬åœ¨ä»»åŠ¡ A ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException();
})
        .<span style="color:#007f7f">exceptionally</span>(ex -&gt; <span style="color:#0ff;font-weight:bold">&#34;errorResultA&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(resultA -&gt; resultA + <span style="color:#0ff;font-weight:bold">&#34; resultB&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(resultB -&gt; resultB + <span style="color:#0ff;font-weight:bold">&#34; resultC&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(resultC -&gt; resultC + <span style="color:#0ff;font-weight:bold">&#34; resultD&#34;</span>);

System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(future.<span style="color:#007f7f">join</span>());
</code></pre></div><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä»»åŠ¡ A æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶åé€šè¿‡ <code>.exceptionally()</code> æ–¹æ³•å¤„ç†äº†å¼‚å¸¸ï¼Œå¹¶è¿”å›æ–°çš„ç»“æœï¼Œè¿™ä¸ªæ–°çš„ç»“æœå°†ä¼ é€’ç»™ä»»åŠ¡ Bã€‚æ‰€ä»¥æœ€ç»ˆçš„è¾“å‡ºç»“æœæ˜¯ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">errorResultA resultB resultC resultD
</code></pre></div><p>å†çœ‹ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦ä¸€ç§å¤„ç†æ–¹å¼ï¼Œä½¿ç”¨ <code>handle(BiFunction fn)</code> æ¥å¤„ç†å¼‚å¸¸ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; future = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(resultA -&gt; resultA + <span style="color:#0ff;font-weight:bold">&#34; resultB&#34;</span>)
        <span style="color:#007f7f">// ä»»åŠ¡ C æŠ›å‡ºå¼‚å¸¸
</span><span style="color:#007f7f"></span>        .<span style="color:#007f7f">thenApply</span>(resultB -&gt; {<span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> RuntimeException();})
        <span style="color:#007f7f">// å¤„ç†ä»»åŠ¡ C çš„è¿”å›å€¼æˆ–å¼‚å¸¸
</span><span style="color:#007f7f"></span>        .<span style="color:#007f7f">handle</span>(<span style="color:#fff;font-weight:bold">new</span> BiFunction&lt;Object, Throwable, Object&gt;() {
            @Override
            <span style="color:#fff;font-weight:bold">public</span> Object apply(Object re, Throwable throwable) {
                <span style="color:#fff;font-weight:bold">if</span> (throwable != <span style="color:#fff;font-weight:bold">null</span>) {
                    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;errorResultC&#34;</span>;
                }
                <span style="color:#fff;font-weight:bold">return</span> re;
            }
        })
        .<span style="color:#007f7f">thenApply</span>(resultC -&gt; resultC + <span style="color:#0ff;font-weight:bold">&#34; resultD&#34;</span>);

System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(future.<span style="color:#007f7f">join</span>());
</code></pre></div><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨äº† <code>handle</code> æ–¹æ³•æ¥å¤„ç†<strong>ä»»åŠ¡ C</strong> çš„æ‰§è¡Œç»“æœï¼Œä¸Šé¢çš„ä»£ç ä¸­ï¼Œ<code>re</code> å’Œ <code>throwable</code> å¿…ç„¶æœ‰ä¸€ä¸ªæ˜¯ nullï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨æ­£å¸¸çš„æ‰§è¡Œç»“æœå’Œå¼‚å¸¸çš„æƒ…å†µã€‚</p>
<blockquote>
<p>å½“ç„¶ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥éƒ½ä¸º nullï¼Œå› ä¸ºå¦‚æœå®ƒä½œç”¨çš„é‚£ä¸ª CompletableFuture å®ä¾‹æ²¡æœ‰è¿”å›å€¼çš„æ—¶å€™ï¼Œre å°±æ˜¯ nullã€‚</p>
</blockquote>
<h2 id="å–ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ">å–ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ</h2>
<p>ä¸Šé¢ä¸€èŠ‚ï¼Œæˆ‘ä»¬è¯´çš„æ˜¯ï¼Œä»»åŠ¡ A æ‰§è¡Œå®Œ -&gt; ä»»åŠ¡ B æ‰§è¡Œå®Œ -&gt; æ‰§è¡Œä»»åŠ¡ Cï¼Œå®ƒä»¬ä¹‹é—´æœ‰å…ˆåæ‰§è¡Œå…³ç³»ï¼Œå› ä¸ºåé¢çš„ä»»åŠ¡ä¾èµ–äºå‰é¢çš„ä»»åŠ¡çš„ç»“æœã€‚</p>
<p>è¿™èŠ‚æˆ‘ä»¬æ¥çœ‹æ€ä¹ˆè®©ä»»åŠ¡ A å’Œä»»åŠ¡ B åŒæ—¶æ‰§è¡Œï¼Œç„¶åå–å®ƒä»¬çš„ç»“æœè¿›è¡Œåç»­æ“ä½œã€‚è¿™é‡Œå¼ºè°ƒçš„æ˜¯ä»»åŠ¡ä¹‹é—´çš„å¹¶è¡Œå·¥ä½œï¼Œæ²¡æœ‰å…ˆåæ‰§è¡Œé¡ºåºã€‚</p>
<p>å¦‚æœä½¿ç”¨ Future çš„è¯ï¼Œæˆ‘ä»¬é€šå¸¸æ˜¯è¿™ä¹ˆå†™çš„ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ExecutorService executorService = Executors.<span style="color:#007f7f">newCachedThreadPool</span>();

Future&lt;String&gt; futureA = executorService.<span style="color:#007f7f">submit</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>);
Future&lt;String&gt; futureB = executorService.<span style="color:#007f7f">submit</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultB&#34;</span>);

String resultA = futureA.<span style="color:#007f7f">get</span>();
String resultB = futureB.<span style="color:#007f7f">get</span>();
</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹çœ‹ CompletableFuture ä¸­æ˜¯æ€ä¹ˆå†™çš„ï¼Œçœ‹ä¸‹é¢çš„å‡ è¡Œä»£ç ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; cfA = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>);
CompletableFuture&lt;String&gt; cfB = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultB&#34;</span>);

cfA.<span style="color:#007f7f">thenAcceptBoth</span>(cfB, (resultA, resultB) -&gt; {});
cfA.<span style="color:#007f7f">thenCombine</span>(cfB, (resultA, resultB) -&gt; <span style="color:#0ff;font-weight:bold">&#34;result A + B&#34;</span>);
cfA.<span style="color:#007f7f">runAfterBoth</span>(cfB, () -&gt; {});
</code></pre></div><p>ç¬¬ 3 è¡Œä»£ç å’Œç¬¬ 4 è¡Œä»£ç æ¼”ç¤ºäº†æ€ä¹ˆä½¿ç”¨ä¸¤ä¸ªä»»åŠ¡çš„ç»“æœ resultA å’Œ resultBï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äºï¼Œ<code>thenAcceptBoth</code> è¡¨ç¤ºåç»­çš„å¤„ç†ä¸éœ€è¦è¿”å›å€¼ï¼Œè€Œ <code>thenCombine</code> è¡¨ç¤ºéœ€è¦è¿”å›å€¼ã€‚</p>
<p>å¦‚æœä½ ä¸éœ€è¦ resultA å’Œ resultBï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ä½¿ç”¨ç¬¬ 5 è¡Œæè¿°çš„ <code>runAfterBoth</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼Œä¸Šé¢çš„å†™æ³•å’Œä¸‹é¢çš„å†™æ³•æ˜¯æ²¡æœ‰åŒºåˆ«çš„ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; cfA = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>);

cfA.<span style="color:#007f7f">thenAcceptBoth</span>(CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultB&#34;</span>),
     (resultA, resultB) -&gt; {});
</code></pre></div><p>åƒä¸‡ä¸è¦ä»¥ä¸ºè¿™ç§å†™æ³•ä»»åŠ¡ A æ‰§è¡Œå®Œäº†ä»¥åå†æ‰§è¡Œä»»åŠ¡ Bã€‚</p>
</blockquote>
<h2 id="å–å¤šä¸ªä»»åŠ¡çš„ç»“æœ">å–å¤šä¸ªä»»åŠ¡çš„ç»“æœ</h2>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸¤ä¸ªéå¸¸ç®€å•çš„é™æ€æ–¹æ³•ï¼šallOf() å’Œ anyOf() æ–¹æ³•ã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> CompletableFuture&lt;Void&gt; allOf(CompletableFuture&lt;?&gt;... cfs){...}
<span style="color:#fff;font-weight:bold">public</span> <span style="color:#fff;font-weight:bold">static</span> CompletableFuture&lt;Object&gt; anyOf(CompletableFuture&lt;?&gt;... cfs) {...}
</code></pre></div><p>è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½éå¸¸ç®€å•ï¼Œç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture cfA = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>);
CompletableFuture cfB = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; 123);
CompletableFuture cfC = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultC&#34;</span>);

CompletableFuture&lt;Void&gt; future = CompletableFuture.<span style="color:#007f7f">allOf</span>(cfA, cfB, cfC);
<span style="color:#007f7f">// æ‰€ä»¥è¿™é‡Œçš„ join() å°†é˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œç»“æŸ
</span><span style="color:#007f7f"></span>future.<span style="color:#007f7f">join</span>();
</code></pre></div><p>ç”±äº allOf èšåˆäº†å¤šä¸ª CompletableFuture å®ä¾‹ï¼Œæ‰€ä»¥å®ƒæ˜¯æ²¡æœ‰è¿”å›å€¼çš„ã€‚è¿™ä¹Ÿæ˜¯å®ƒçš„ä¸€ä¸ªç¼ºç‚¹ã€‚</p>
<p>anyOf ä¹Ÿéå¸¸å®¹æ˜“ç†è§£ï¼Œå°±æ˜¯åªè¦æœ‰ä»»æ„ä¸€ä¸ª CompletableFuture å®ä¾‹æ‰§è¡Œå®Œæˆå°±å¯ä»¥äº†ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture cfA = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultA&#34;</span>);
CompletableFuture cfB = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; 123);
CompletableFuture cfC = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;resultC&#34;</span>);

CompletableFuture&lt;Object&gt; future = CompletableFuture.<span style="color:#007f7f">anyOf</span>(cfA, cfB, cfC);
Object result = future.<span style="color:#007f7f">join</span>();
</code></pre></div><p>æœ€åä¸€è¡Œçš„ join() æ–¹æ³•ä¼šè¿”å›æœ€å…ˆå®Œæˆçš„ä»»åŠ¡çš„ç»“æœï¼Œæ‰€ä»¥å®ƒçš„æ³›å‹ç”¨çš„æ˜¯ Objectï¼Œå› ä¸ºæ¯ä¸ªä»»åŠ¡å¯èƒ½è¿”å›çš„ç±»å‹ä¸åŒã€‚</p>
<h3 id="either-æ–¹æ³•">either æ–¹æ³•</h3>
<p>å¦‚æœä½ çš„ anyOf(&hellip;) åªéœ€è¦å¤„ç†ä¸¤ä¸ª CompletableFuture å®ä¾‹ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ä½¿ç”¨ <code>xxxEither()</code> æ¥å¤„ç†ï¼Œ</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">cfA.<span style="color:#007f7f">acceptEither</span>(cfB, result -&gt; {});
cfA.<span style="color:#007f7f">acceptEitherAsync</span>(cfB, result -&gt; {});
cfA.<span style="color:#007f7f">acceptEitherAsync</span>(cfB, result -&gt; {}, executorService);

cfA.<span style="color:#007f7f">applyToEither</span>(cfB, result -&gt; {<span style="color:#fff;font-weight:bold">return</span> result;});
cfA.<span style="color:#007f7f">applyToEitherAsync</span>(cfB, result -&gt; {<span style="color:#fff;font-weight:bold">return</span> result;});
cfA.<span style="color:#007f7f">applyToEitherAsync</span>(cfB, result -&gt; {<span style="color:#fff;font-weight:bold">return</span> result;}, executorService);

cfA.<span style="color:#007f7f">runAfterEither</span>(cfA, () -&gt; {});
cfA.<span style="color:#007f7f">runAfterEitherAsync</span>(cfB, () -&gt; {});
cfA.<span style="color:#007f7f">runAfterEitherAsync</span>(cfB, () -&gt; {}, executorService);
</code></pre></div><p>ä¸Šé¢çš„å„ä¸ªå¸¦ <strong>either</strong> çš„æ–¹æ³•ï¼Œè¡¨è¾¾çš„éƒ½æ˜¯ä¸€ä¸ªæ„æ€ï¼ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªä»»åŠ¡ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ‰§è¡Œå®Œæˆï¼Œå°±æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œã€‚å®ƒä»¬å‡ ç»„çš„åŒºåˆ«ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œåˆ†åˆ«ç”¨äºè¡¨è¾¾æ˜¯å¦éœ€è¦ä»»åŠ¡ A å’Œä»»åŠ¡ B çš„æ‰§è¡Œç»“æœï¼Œæ˜¯å¦éœ€è¦è¿”å›å€¼ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šå¯¹è¿™é‡Œçš„å‡ ä¸ªå˜ç§æœ‰ç›²åŒºï¼Œè¿™é‡Œé¡ºä¾¿è¯´å‡ å¥ã€‚</p>
<p>1ã€<code>cfA.acceptEither(cfB, result -&gt; {});</code> å’Œ <code>cfB.acceptEither(cfA, result -&gt; {});</code> æ˜¯ä¸€ä¸ªæ„æ€ï¼›</p>
<p>2ã€ç¬¬äºŒä¸ªå˜ç§ï¼ŒåŠ äº† <strong>Async</strong> åç¼€çš„æ–¹æ³•ï¼Œä»£è¡¨å°†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æ”¾åˆ° ForkJoinPool.commonPool() ä¸­æ‰§è¡Œ(éå®Œå…¨ä¸¥è°¨)ï¼›ç¬¬ä¸‰ä¸ªå˜ç§å¾ˆå¥½ç†è§£ï¼Œå°†ä»»åŠ¡æ”¾åˆ°æŒ‡å®šçº¿ç¨‹æ± ä¸­æ‰§è¡Œï¼›</p>
<p>3ã€éš¾é“ç¬¬ä¸€ä¸ªå˜ç§æ˜¯åŒæ­¥çš„ï¼Ÿä¸æ˜¯çš„ï¼Œè€Œæ˜¯è¯´ï¼Œå®ƒç”±ä»»åŠ¡ A æˆ–ä»»åŠ¡ B æ‰€åœ¨çš„æ‰§è¡Œçº¿ç¨‹æ¥æ‰§è¡Œï¼Œå–å†³äºå“ªä¸ªä»»åŠ¡å…ˆç»“æŸã€‚</p>
<h2 id="compose">compose</h2>
<p><strong>update on 2019-07-26</strong></p>
<p>è¿™é‡Œæˆ‘ä»¬ç®€å•æ¥è¯´è¯´ CompletableFuture çš„æœ€åä¸€å—æ‹¼å›¾ï¼Œ<strong>compose</strong> æ–¹æ³•ã€‚</p>
<p>å‰é¢æˆ‘ä»¬ä»‹ç»äº† <code>thenAcceptBoth</code> å’Œ <code>thenCombine</code> ç”¨äºèšåˆä¸¤ä¸ªä»»åŠ¡ï¼Œå…¶å® compose ä¹Ÿæ˜¯ä¸€æ ·çš„åŠŸèƒ½ï¼Œå®ƒä»¬æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸ºäº†è®©å¤šä¸ª CompletableFuture å®ä¾‹å½¢æˆä¸€ä¸ª<strong>é“¾</strong>ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ç”¨ä»£ç æ¥è¯´å§ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; cfA = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;processing a...&#34;</span>);
    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>;
});

CompletableFuture&lt;String&gt; cfB = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;processing b...&#34;</span>);
    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34; world&#34;</span>;
});

CompletableFuture&lt;String&gt; cfC = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(<span style="color:#0ff;font-weight:bold">&#34;processing c...&#34;</span>);
    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;, I&#39;m robot!&#34;</span>;
});
</code></pre></div><p>æˆ‘ä»¬ç¤ºä¾‹ä¸‰ä¸ªå®ä¾‹çš„æƒ…å†µï¼Œè¿™è¾¹ä¸ä»‹ç» thenAcceptBoth äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ thenCombine:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">cfA.<span style="color:#007f7f">thenCombine</span>(cfB, (resultA, resultB) -&gt; {
    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(resultA + resultB);  <span style="color:#007f7f">// hello world
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> resultA + resultB;
}).<span style="color:#007f7f">thenCombine</span>(cfC, (resultAB, resultC) -&gt; {
    System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(resultAB + resultC); <span style="color:#007f7f">// hello world, I&#39;m robot!
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> resultAB + resultC;
});
</code></pre></div><p>æˆ‘ä»¬å…ˆæœ‰ cfAï¼Œç„¶åå’Œ cfB ç»„æˆä¸€ä¸ªé“¾ï¼š<code>cfA -&gt; cfB</code>ï¼Œç„¶ååˆç»„åˆäº† cfCï¼Œå½¢æˆé“¾ï¼š<code>cfA -&gt; cfB -&gt; cfC</code>ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸ªéšè—çš„ç‚¹ï¼šcfAã€cfBã€cfC å®ƒä»¬å®Œå…¨æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬åªä¸è¿‡æ˜¯èšåˆäº†å®ƒä»¬çš„ç»“æœã€‚</p>
<p>è¿™ä¸‹çœ‹ compose å°±æ¸…æ¥šäº†ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; result = CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    <span style="color:#007f7f">// ç¬¬ä¸€ä¸ªå®ä¾‹çš„ç»“æœ
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>;
}).<span style="color:#007f7f">thenCompose</span>(resultA -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    <span style="color:#007f7f">// æŠŠä¸Šä¸€ä¸ªå®ä¾‹çš„ç»“æœä¼ é€’åˆ°è¿™é‡Œ
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> resultA + <span style="color:#0ff;font-weight:bold">&#34; world&#34;</span>;
})).<span style="color:#007f7f">thenCompose</span>(resultAB -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; {
    <span style="color:#007f7f">// åˆ°è¿™é‡Œå¤§å®¶åº”è¯¥å¾ˆæ¸…æ¥šäº†
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">return</span> resultAB + <span style="color:#0ff;font-weight:bold">&#34;, I&#39;m robot&#34;</span>;
}));

System.<span style="color:#007f7f">out</span>.<span style="color:#007f7f">println</span>(result.<span style="color:#007f7f">join</span>()); <span style="color:#007f7f">// hello world, I&#39;m robot
</span></code></pre></div><p>å‰é¢ä¸€ä¸ª CompletableFuture å®ä¾‹çš„ç»“æœå¯ä»¥ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå®ä¾‹ä¸­ï¼Œè¿™å°±æ˜¯ compose å’Œ combine çš„ä¸»è¦åŒºåˆ«ã€‚</p>
<p>combine æ˜¯æŠŠç»“æœè¿›è¡Œèšåˆï¼Œä½†æ˜¯ compose æ›´åƒæ˜¯æŠŠå¤šä¸ªå·²æœ‰çš„ cf å®ä¾‹ç»„åˆæˆä¸€ä¸ªæ•´ä½“çš„å®ä¾‹ã€‚</p>
<h2 id="thencompose-å’Œ-thenapply-çš„åŒºåˆ«">thenCompose å’Œ thenApply çš„åŒºåˆ«</h2>
<p>è¯„è®ºåŒºæœ‰åŒå­¦å…³æ³¨åˆ°äº† thenApply å’Œ thenComposeï¼Œè¿™é‡Œç®€å•è¯´è¯´ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒä»¬çš„æ–¹æ³•è´´åˆ°ä¸€èµ·å¯¹æ¯”ä¸€ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenApply(
    Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T,? <span style="color:#fff;font-weight:bold">extends</span> U&gt; fn) {
    <span style="color:#fff;font-weight:bold">return</span> uniApplyStage(<span style="color:#fff;font-weight:bold">null</span>, fn);
}
<span style="color:#fff;font-weight:bold">public</span> &lt;U&gt; CompletableFuture&lt;U&gt; thenCompose(
    Function&lt;? <span style="color:#fff;font-weight:bold">super</span> T, ? <span style="color:#fff;font-weight:bold">extends</span> CompletionStage&lt;U&gt;&gt; fn) {
    <span style="color:#fff;font-weight:bold">return</span> uniComposeStage(<span style="color:#fff;font-weight:bold">null</span>, fn);
}
</code></pre></div><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;String&gt; future1 = CompletableFuture
        .<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(cfA -&gt; cfA + <span style="color:#0ff;font-weight:bold">&#34; world&#34;</span>);

CompletableFuture&lt;String&gt; future2 = CompletableFuture
        .<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>)
        .<span style="color:#007f7f">thenCompose</span>(cfA -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; cfA + <span style="color:#0ff;font-weight:bold">&#34; world&#34;</span>));
</code></pre></div><p>å®ƒä»¬éƒ½éœ€è¦æ¥æ”¶ä¸€ä¸ª Functionï¼Œè¿™ä¸ªå‡½æ•°çš„ä¸»è¦çš„åŒºåˆ«åœ¨äº thenApply ä¸­è¿”å›ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œè€Œ thenCompose è¿”å›ä¸€ä¸ªæ–°çš„ cf å®ä¾‹ã€‚</p>
<p>thenApply ç±»ä¼¼äº <strong>map</strong> æ“ä½œï¼ŒæŠŠ cf å®ä¾‹çš„ç»“æœåŠ å·¥æˆå¦ä¸€ä¸ªå€¼ï¼Œåƒ Stream é‡Œé¢çš„ map() æ–¹æ³•ã€‚å®ƒè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹å¾ï¼Œè¿™é‡Œæ˜¯<strong>åŒæ­¥</strong>çš„æ“ä½œã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥çš„ map æ“ä½œï¼Œé‚£ä¹ˆå°±åº”è¯¥ä½¿ç”¨ thenCompose äº†ï¼Œæ¯”å¦‚ä¸Šé¢çš„ç¬¬äºŒä¸ªä¾‹å­ã€‚</p>
<p>æˆ‘ä»¬æ¥ç»§ç»­è¾ƒçœŸä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è®© thenApply çš„ Function ä¹Ÿè¿”å› CompletableFuture å®ä¾‹ï¼Œä¸å°±å®ç°äº†å¼‚æ­¥çš„éœ€æ±‚ï¼š</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">CompletableFuture&lt;CompletableFuture&lt;String&gt;&gt; future = CompletableFuture
        .<span style="color:#007f7f">supplyAsync</span>(() -&gt; <span style="color:#0ff;font-weight:bold">&#34;hello&#34;</span>)
        .<span style="color:#007f7f">thenApply</span>(cfA -&gt; CompletableFuture.<span style="color:#007f7f">supplyAsync</span>(() -&gt; cfA + <span style="color:#0ff;font-weight:bold">&#34; world&#34;</span>));
</code></pre></div><p>å¯æ˜¯ï¼Œè¿”å›å€¼æˆ‘ä»¬å¯å°±ä¸å¤ªå–œæ¬¢äº†ã€‚è¯´åˆ°è¿™é‡Œï¼Œå¤§å®¶å¯èƒ½ä¼šæƒ³åˆ° Stream é‡Œé¢çš„ flatMap() äº†ã€‚</p>
<h2 id="å°ç»“">å°ç»“</h2>
<p>å…³äº CompletableFutureï¼Œæœ¬æ–‡å·²ç»è¦†ç›–äº†ç»å¤§å¤šæ•°çš„æ¥å£ã€‚å¦‚æœè¿˜æœ‰ä¸äº†è§£çš„æ¥å£ï¼Œæ¬¢è¿å„ä½åœ¨ç•™è¨€æ¿ä¸­è¿›è¡Œäº¤æµã€‚</p>
<p><strong>è‘—ä½œæƒå½’åŸä½œè€…æ‰€æœ‰ï¼Œ<a href="https://www.javadoop.com/post/completable-future">åŸæ–‡é“¾æ¥</a>ã€‚</strong></p>

  </article>
</section>


    </div>

    <footer class="footer">
  <div class="footer-taxonomy">
    <div style="margin-bottom: 10px;">
      <a href="https://wiki.bmpi.dev/" rel="nofollow">Wiki</a>
      âš”ï¸
      <a href="https://talk.bmpi.dev/" rel="nofollow">Talk</a>
      âš”ï¸
      <a href="https://www.notion.so/mdw/e0ed086e701a4d0aaa4839d2c7aa62ea" rel="nofollow">Portfolio</a>
      âš”ï¸
      <a href="https://money.i365.tech/">Money</a>
    </div>
    <div>
      <a href= /affiliate >Affiliate</a>
      âš¡ï¸
      <a href= /tool >Tool</a>
      âš¡ï¸
      <a href= /link >Link</a>
    </div>
  </div>
  <div class="footer-taxonomy">
    <a href= /tags style="color: #B36D61;">Tags</a>
    ğŸ‘ˆ
    <a href= /categories style="color: #FF8C31;">Categories</a>
    ğŸ‘‰
    <a href= /series style="color: #519A73;">Series</a>
  </div>
  <section class="container">
    
     Â© 2019 - 2020
    
    
  </section>
</footer>

  </main>

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154678195-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-154678195-1');
  </script>
  

  
  <script>(function(w,d, s, id) {w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.src = "https://cdn.webpushr.com/app.min.js";fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));webpushr('init','BHuwaXciWicBjh6HQS2tfudv6IYQD11K9u1NUj7nuaEV9NoDT7ns9JjgqyYTflUv-m3TlD7ELY84AHMfgmPXNgU');</script>
  

</body>

</html>
